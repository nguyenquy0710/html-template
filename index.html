<!DOCTYPE html>
<html lang="vi">

  <head>
    <meta charset="UTF-8">
    <title>Danh sách URL theo nhóm</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
      body,
      html {
        height: 100%;
        margin: 0;
      }

      iframe {
        width: 100%;
        height: 100%;
        border: none;
      }

      .sidebar {
        height: 100vh;
        overflow-y: auto;
        border-right: 1px solid #ddd;
      }

      .group-title {
        font-weight: bold;
        margin-top: 20px;
        margin-bottom: 10px;
        cursor: pointer;
        color: #555;
        font-size: 1rem;
        display: flex;
        align-items: center;
        user-select: none;
      }

      .group-title .arrow {
        margin-left: auto;
        transition: transform 0.3s ease;
        font-size: 0.9rem;
      }

      .group-title.expanded .arrow {
        transform: rotate(180deg);
      }

      .list-group-item.active {
        font-weight: bold;
        background-color: #0d6efd;
        color: white;
      }

      /* Animation collapse */
      .collapse-container {
        overflow: hidden;
        transition: max-height 0.4s ease;
        max-height: 1000px;
        /* open state */
      }

      .collapse-container.collapsing {
        max-height: 0;
      }
    </style>
  </head>

  <body>
    <div class="container-fluid h-100">
      <div class="row h-100">
        <!-- Sidebar -->
        <div class="col-md-3 sidebar p-3 bg-light">
          <h5 class="mb-3">📄 Danh sách trang</h5>
          <input type="text" id="search" class="form-control mb-3" placeholder="Tìm kiếm...">
          <div id="url-list"></div>
        </div>

        <!-- Main content -->
        <div class="col-md-9 p-0">
          <iframe id="content-frame" src=""></iframe>
        </div>
      </div>
    </div>

    <!-- Import urls -->
    <script src="urls.js"></script>

    <!-- Script -->
    <script>
      const urlList = document.getElementById('url-list');
      const iframe = document.getElementById('content-frame');
      const searchInput = document.getElementById('search');

      let allLinkElements = [];

      function renderList(filter = '') {
        urlList.innerHTML = '';
        allLinkElements = [];

        urls.forEach((group, groupIndex) => {
          const filteredLinks = group.links.filter(link =>
            link.name.toLowerCase().includes(filter.toLowerCase())
          );

          if (filteredLinks.length > 0) {
            // Group container
            const groupContainer = document.createElement('div');
            groupContainer.classList.add('mb-3');

            // Group title
            const groupTitle = document.createElement('div');
            groupTitle.className = 'group-title expanded';
            groupTitle.innerHTML = `${group.group}<span class="arrow">▲</span>`;

            // Links container
            const linksContainer = document.createElement('div');
            linksContainer.className = 'collapse-container';

            filteredLinks.forEach(link => {
              const linkItem = document.createElement('div');
              linkItem.className = 'list-group-item list-group-item-action';
              linkItem.style.cursor = 'pointer';
              linkItem.textContent = link.name;

              linkItem.addEventListener('click', () => {
                iframe.src = link.path;
                localStorage.setItem('lastOpenedUrl', link.path);
                document.querySelectorAll('.list-group-item').forEach(el => {
                  el.classList.remove('active');
                  el.textContent = el.dataset.originalName;
                });
                linkItem.classList.add('active');
                linkItem.textContent = `🔵 ${linkItem.dataset.originalName}`;
              });

              linkItem.dataset.originalName = link.name;
              linksContainer.appendChild(linkItem);
              allLinkElements.push({ element: linkItem, path: link.path });
            });

            groupTitle.addEventListener('click', () => {
              const expanded = groupTitle.classList.contains('expanded');

              // Đóng tất cả nhóm khác trước
              document.querySelectorAll('.group-title').forEach(title => {
                title.classList.remove('expanded');
                title.classList.add('collapsed');
              });
              document.querySelectorAll('.collapse-container').forEach(container => {
                container.classList.add('collapsing');
                container.style.maxHeight = '0';
              });

              if (!expanded) {
                // Mở nhóm đang click
                groupTitle.classList.add('expanded');
                groupTitle.classList.remove('collapsed');

                linksContainer.classList.remove('collapsing');
                linksContainer.style.maxHeight = linksContainer.scrollHeight + 'px';
                setTimeout(() => {
                  linksContainer.style.maxHeight = '1000px';
                }, 400);
              }
            });

            groupContainer.appendChild(groupTitle);
            groupContainer.appendChild(linksContainer);
            urlList.appendChild(groupContainer);
          }
        });
      }

      searchInput.addEventListener('input', (e) => {
        renderList(e.target.value);
      });

      // Initial render
      renderList();

      // Restore last opened URL
      window.addEventListener('DOMContentLoaded', () => {
        const lastOpened = localStorage.getItem('lastOpenedUrl');
        const matched = allLinkElements.find(item => item.path === lastOpened);
        if (matched) {
          iframe.src = matched.path;
          matched.element.classList.add('active');
          matched.element.textContent = `🔵 ${matched.element.dataset.originalName}`;
        } else if (allLinkElements.length > 0) {
          iframe.src = allLinkElements[0].path;
          allLinkElements[0].element.classList.add('active');
          allLinkElements[0].element.textContent = `🔵 ${allLinkElements[0].element.dataset.originalName}`;
        }
      });
    </script>
  </body>

</html>